import{d as de,q as P,r as a,c as h,f as me,J as b,K as R,B as v,N as O,M as pe,v as V,S as U,m as c,y as p,a as fe,L as j,x as i,g as y,G as ve,H as ce,I as he,n as G}from"./vue.esm-bundler-D4RNtN6S.js";import{_ as J}from"./CButton-CYpEF-bO.js";import{C}from"./CIcon-BdIW6TD_.js";import{C as be}from"./CInput-JyLJ_8RY.js";import{_ as Q}from"./CTooltip-CEaW1Ntp.js";import{_ as ye}from"./CCollapseTransition-Dr-u_SKe.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Button-CF0RFvFf.js";import"./use-rtl-DB_faxJd.js";import"./light-DsB5ODev.js";import"./browser-DLIXj5nt.js";import"./is-browser-DqcmxZSF.js";import"./icon-switch.cssr-CS-aOSlJ.js";import"./resolve-slot-BBjw-So6.js";import"./use-style-DC-6GAXR.js";import"./FadeInExpandTransition-LhRfDe22.js";import"./Loading-Ch5S3HjA.js";import"./use-memo-CglecHn5.js";import"./use-form-item-BaX4b55j.js";import"./light-CaBpc4YN.js";import"./use-css-vars-class-BoK1eXI1.js";import"./color-to-class-B0iQgAn2.js";import"./call-f2ri57Kd.js";import"./Input-DEy15p9s.js";import"./Scrollbar-BbWWFAp8.js";import"./fade-in.cssr-DJOFltAV.js";import"./VResizeObserver-DllAtjZA.js";import"./index-Xn0jilRV.js";import"./delegate-AmuGJuoF.js";import"./light-RknvjviJ.js";import"./get-precise-event-target-DhO46Lpt.js";import"./Suffix-BjoWbega.js";import"./Icon-CrmNSR1a.js";import"./replaceable-DM1aDluB.js";import"./upperFirst-CgVWOQVP.js";import"./toString-Vm_cEZ4d.js";import"./light-3lQabVNk.js";import"./use-locale-CfrJhm3r.js";import"./enUS-CW6P5ZC_.js";import"./use-merged-state-CUYpy2WA.js";import"./Tooltip-BYkYGbMt.js";import"./Popover-axeHrzq9.js";import"./index-CIE75m1q.js";import"./Follower-DXtmSYJu.js";import"./cssr-ChHp6ynC.js";import"./utils-Dy8q55w_.js";import"./light-BUP7UYSb.js";import"./index-Bg4fAuci.js";import"./index-L98eAIry.js";import"./get-first-slot-vnode-BHWfc99-.js";import"./flatten-B94A2huW.js";import"./keep-B1eBS8j0.js";import"./use-compitable-B7ANSQOo.js";import"./light-Lzn-IxFN.js";import"./fade-in-height-expand.cssr-BiZZSMP_.js";import"./light-C7NmY139.js";const Te={class:"c-editable-field__control"},we={key:"save"},Ee={key:"edit"},Me={key:0,class:"c-editable-field__error"},te=de({__name:"CEditableField",props:{value:{},isEditable:{type:Boolean,default:!0},placeholder:{default:""},saveHandler:{type:Function,default:void 0},inputWidth:{default:300},blurTimeoutMs:{default:300},savedTimeoutMs:{default:2500},errorTimeoutMs:{default:1500},hasTooltips:{type:Boolean,default:!1},isAlignedLeft:{type:Boolean,default:!1},validators:{default:null}},setup(g){const l=g;P(()=>{T()});const w=a(null),E=a(null),r=a(null),M=a(null),n=a(0),q=a(0),F=a(0),f=a(""),o=a(!1),$=a(null),B=a(!1),u=a(!1),d=a(!1),m=a(!1),_=a(!1),N=h(()=>!l.validators||!o.value?{isValid:!0,errors:[]}:Object.entries(l.validators).reduce((e,[t,s])=>{const S=s(f.value);return{isValid:S?e.isValid:!1,errors:S?e.errors:[...e.errors,t]}},{isValid:!0,errors:[]})),I=h(()=>N.value.isValid),ae=h(()=>N.value.errors),k=a(!1),z=h(()=>_.value||!I.value&&k.value),le=h(()=>{const e=q.value-F.value,t=n.value>l.inputWidth?n.value:l.inputWidth,s=e&&t>e?e:t,S=e&&n.value>e?e:n.value;return{minWidth:`${o.value?s:S}px`}});P(()=>{window.addEventListener("resize",T)}),me(()=>{window.removeEventListener("resize",T)});function ie(){T(),o.value=!0,f.value=l.value,L()}function L(){G(()=>{var e;return(e=w.value)==null?void 0:e.focus()})}function x(){u.value||B.value||(o.value=!1,m.value=!1,k.value=!1,_.value=!1,f.value="",G(T),H())}function A(){$.value=window.setTimeout(x,l.blurTimeoutMs)}function H(){$.value&&window.clearTimeout($.value)}function oe(){H()}function T(){var e,t,s;n.value=((e=E.value)==null?void 0:e.offsetWidth)??n.value,q.value=((t=r.value)==null?void 0:t.offsetWidth)??q.value,F.value=((s=M.value)==null?void 0:s.offsetWidth)??F.value}const D=h(()=>f.value===l.value&&o.value||!I.value&&k.value);async function K(){var e;if(!(D.value||u.value||d.value||!o.value||m.value)){if(H(),k.value=!0,!I.value){L();return}u.value=!0;try{await((e=l.saveHandler)==null?void 0:e.call(l,f.value)),d.value=!0,se(),u.value=!1,x()}catch{u.value=!1,m.value=!0,_.value=!0,re(),L()}}}function se(){window.setTimeout(()=>{d.value=!1},l.savedTimeoutMs)}function re(){window.setTimeout(()=>{m.value=!1},l.errorTimeoutMs)}function ne(){B.value=!1,A()}function ue(){_.value=!1}return(e,t)=>(i(),b("div",{ref_key:"field",ref:r,class:j(["c-editable-field",{"c-editable-field--aligned-left":e.isAlignedLeft}])},[R("div",Te,[R("div",{class:"c-editable-field__value",style:pe(le.value)},[o.value&&e.isEditable?(i(),V(be,{key:0,ref_key:"input",ref:w,value:f.value,"onUpdate:value":t[0]||(t[0]=s=>f.value=s),disabled:u.value,"has-error":z.value,class:"c-editable-field__input",placeholder:e.placeholder,onBlur:A,onFocus:oe,onKeydown:U(K,["enter"]),onKeyup:U(x,["esc"]),onInput:ue},null,8,["value","disabled","has-error","placeholder"])):(i(),b("span",{key:1,ref_key:"text",ref:E,class:"c-editable-field__text"},[e.value?c(e.$slots,"value",{key:0},()=>[y(ve(e.value),1)],!0):c(e.$slots,"value-empty",{key:1},()=>[t[2]||(t[2]=y(" â€” "))],!0)],512))],4),e.isEditable?(i(),b("div",{key:0,ref_key:"controls",ref:M,class:"c-editable-field__controls"},[v(fe,{name:o.value||d.value?void 0:"opacity",mode:"out-in"},{default:p(()=>[o.value||d.value?(i(),b("div",we,[v(Q,{disabled:!e.hasTooltips,delay:500},{trigger:p(()=>[v(J,{secondary:"",size:"small",type:m.value?"error":"success",disabled:D.value,loading:u.value,class:j(["c-editable-field__save-button",{"c-editable-field__save-button--processing":u.value||d.value||m.value}]),circle:"",onClick:K,onFocus:t[1]||(t[1]=s=>B.value=!0),onBlur:ne},{icon:p(()=>[d.value?(i(),V(C,{key:0,class:"c-editable-field__saved-status-icon","is-inline":!0,name:"checkmark"})):m.value?(i(),V(C,{key:1,class:"c-editable-field__error-status-icon","is-inline":!0,name:"close"})):(i(),V(C,{key:2,"is-inline":!0,name:"save"}))]),_:1},8,["type","disabled","loading","class"])]),default:p(()=>[d.value?c(e.$slots,"tooltip-saved-message",{key:0},()=>[t[3]||(t[3]=y(" Saved "))],!0):m.value?c(e.$slots,"tooltip-error-message",{key:1},()=>[t[4]||(t[4]=y(" Error "))],!0):c(e.$slots,"tooltip-save-button",{key:2},()=>[t[5]||(t[5]=y(" Save "))],!0)]),_:3},8,["disabled"])])):(i(),b("div",Ee,[v(Q,{disabled:!e.hasTooltips,delay:500},{trigger:p(()=>[v(J,{quaternary:"",size:"small",circle:"",class:"c-editable-field__edit-button",onClick:ie},{icon:p(()=>[v(C,{"is-inline":!0,name:"pencil"})]),_:1})]),default:p(()=>[c(e.$slots,"tooltip-edit-button",{},()=>[t[6]||(t[6]=y(" Edit "))],!0)]),_:3},8,["disabled"])]))]),_:3},8,["name"])],512)):O("",!0)]),v(ye,{show:z.value&&!!e.$slots.error},{default:p(()=>[z.value&&e.$slots.error?(i(),b("div",Me,[c(e.$slots,"error",ce(he({errors:ae.value})),void 0,!0)])):O("",!0)]),_:3},8,["show"])],2))}}),X=ge(te,[["__scopeId","data-v-624ff89e"]]);te.__docgenInfo={exportName:"default",displayName:"CEditableField",description:"",tags:{},props:[{name:"value",description:"The current value of the editable field.",required:!0,type:{name:"string"}},{name:"isEditable",description:"Whether the field is editable.",required:!1,type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"placeholder",description:"Placeholder text for the input when it's empty.",required:!1,type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"saveHandler",description:"Handler function executed when the value is saved. Can be synchronous or return a promise.",required:!1,type:{name:"TSFunctionType"},defaultValue:{func:!1,value:"undefined"}},{name:"inputWidth",description:"The width of the input field.",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"blurTimeoutMs",description:"Timeout (in ms) for stopping editing when the input loses focus.",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"savedTimeoutMs",description:"Timeout (in ms) for resetting the saved state.",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"2500"}},{name:"errorTimeoutMs",description:"Timeout (in ms) for resetting the error state.",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"1500"}},{name:"hasTooltips",description:"Whether to display tooltips for the save and edit buttons.",required:!1,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"isAlignedLeft",description:"Whether to align the text to the left.",required:!1,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"validators",description:`Custom validation functions for the input value.
Can contain multiple validators which return true/false based on the validity of the value.`,required:!1,type:{name:"union",elements:[{name:"Record",elements:[{name:"string"},{name:"TSFunctionType"}]},{name:"null"}]},defaultValue:{func:!1,value:"null"}}],slots:[{name:"value"},{name:"value-empty"},{name:"tooltip-saved-message"},{name:"tooltip-error-message"},{name:"tooltip-save-button"},{name:"tooltip-edit-button"},{name:"error",scoped:!0,bindings:[{name:"errors",title:"binding"}]}],sourceFiles:["/home/runner/work/npm-pew-pew/npm-pew-pew/src/components/CEditableField/CEditableField.vue"]};const St={title:"Components/EditableField",component:X,tags:["autodocs"],decorators:[g=>({components:{story:g},template:'<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px; align-items: center"><story/></div>'})],argTypes:{value:{control:!1},saveHandler:{control:!1},inputWidth:{control:"number"},blurTimeoutMs:{control:"number"},savedTimeoutMs:{control:"number"},errorTimeoutMs:{control:"number"},validators:{control:!1},"value-empty":{control:!1},"tooltip-saved-message":{control:!1},"tooltip-error-message":{control:!1},"tooltip-save-button":{control:!1},"tooltip-edit-button":{control:!1},error:{control:!1}},parameters:{docs:{description:{component:"A flexible and customizable component for inline editing. It allows users to edit text with built-in validation, saving functionality, and error handling. Supports tooltips, save/cancel actions, and the option to align the text left, with dynamic control over input width and error states."}}},render:g=>({components:{CEditableField:X},setup(){const l=a("test@email.com"),w=a({required:r=>r.length!==0,email:r=>r.includes("@")});async function E(r){await new Promise((M,n)=>{setTimeout(()=>{(Math.random()>.6?n:M)()},500)}),l.value=r}return{args:g,emailValidators:w,email:l,handleEmailSave:E}},template:`
      <CEditableField
        :value="email"
        :isEditable="args.isEditable"
        :placeholder="args.placeholder"
        :saveHandler="handleEmailSave"
        :inputWidth="args.inputWidth"
        :blurTimeoutMs="args.blurTimeoutMs"
        :savedTimeoutMs="args.savedTimeoutMs"
        :errorTimeoutMs="args.errorTimeoutMs"
        :hasTooltips="args.hasTooltips"
        :isAlignedLeft="args.isAlignedLeft"
        :validators="emailValidators"
      >
        <template #error="{ errors }">
          <template v-if="errors.includes('required')">
            Email is required
          </template>
          <template v-else-if="errors.includes('email')">
            Invalid email
          </template>
        </template>
      </CEditableField>
    `})},W={args:{isEditable:!0,blurTimeoutMs:5e3,savedTimeoutMs:3e3,errorTimeoutMs:3e3,hasTooltips:!0}};var Y,Z,ee;W.parameters={...W.parameters,docs:{...(Y=W.parameters)==null?void 0:Y.docs,source:{originalSource:`{
  args: {
    isEditable: true,
    blurTimeoutMs: 5000,
    savedTimeoutMs: 3000,
    errorTimeoutMs: 3000,
    hasTooltips: true
  }
}`,...(ee=(Z=W.parameters)==null?void 0:Z.docs)==null?void 0:ee.source}}};const Vt=["Default"];export{W as Default,Vt as __namedExportsOrder,St as default};
